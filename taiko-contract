# Use an official Node.js runtime as a parent image
FROM node:18

# Set the working directory in the container
WORKDIR /usr/src/app

# Copy the current directory contents into the container at /usr/src/app
COPY . .

# Install Foundry (forge) and add it to PATH
RUN curl -L https://foundry.paradigm.xyz | bash && \
    /root/.foundry/bin/foundryup && \
    /root/.foundry/bin/forge install && \
    echo 'export PATH="/root/.foundry/bin:$PATH"' >> ~/.bashrc

# Change the working directory to packages/protocol
WORKDIR /usr/src/app/packages/protocol

# Make the script files executable
RUN chmod +x script/layer1/*.sh

# Set environment variables
ENV PRIVATE_KEY=0xbcdf20249abf0ed6d944c0288fad489e33f66b3960d9e6229c1cd214ed3bbe31
ENV FORK_URL="http://139.162.249.67:32002"
ENV PATH="/root/.foundry/bin:$PATH"

# Default command to run if no arguments are provided
CMD ["sh", "-c", "script/layer1/deploy_protocol_on_l1.sh"]
